<!DOCTYPE html>
<html>
<head>
  <!-- <meta http-equiv="refresh" content="2"> -->
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>



  <script>
    var cvs, ctx;

    var nt = {
      "/steeringwheel/buttons": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    }


    var drawButton = function(pos, state) {
      ctx.fillStyle = state ? "#CCC" : "#666";
      ctx.beginPath();
      ctx.arc(pos.x, pos.y, 20, 0, 2*Math.PI);
      ctx.fill();
    };
    
    var refresh = function() {
      cvs = canvas;
      ctx = cvs.getContext("2d");

      cvs.width = window.innerWidth;
      cvs.height = window.innerHeight;

      // clear canvas
      ctx.fillStyle = "#222";
      ctx.fillRect(0, 0, cvs.width, cvs.height);


      // buttons page
      drawButton({x: 50, y: 50}, nt["/steeringwheel/buttons"][0]);
      drawButton({x: 100, y: 100}, nt["/steeringwheel/buttons"][1]);
      drawButton({x: 100, y: 250}, nt["/steeringwheel/buttons"][2]);
      drawButton({x: 150, y: 325}, nt["/steeringwheel/buttons"][3]);
      drawButton({x: 150, y: 400}, nt["/steeringwheel/buttons"][4]);
      
      drawButton({x: cvs.width - 50, y: 50}, nt["/steeringwheel/buttons"][5]);
      drawButton({x: cvs.width - 100, y: 100}, nt["/steeringwheel/buttons"][6]);
      drawButton({x: cvs.width - 100, y: 250}, nt["/steeringwheel/buttons"][7]);
      drawButton({x: cvs.width - 150, y: 325}, nt["/steeringwheel/buttons"][8]);
      drawButton({x: cvs.width - 150, y: 400}, nt["/steeringwheel/buttons"][9]);
    }

    window.onload = refresh;
  </script>
  
  <script>
    // http://www.websocket.org/echo.html
  
    var ws = new WebSocket("ws://10.20.22.1:6202/ws");
    var ws_connected = false;
  
    ws.onopen = function (e) {
      console.log("Connected to websocket.");
      ws_connected = true;
    };
  
    ws.onclose = function (e) {
      console.log("websocket Disconnected.");
    };
  
    ws.onmessage = function (e) {
      console.log("<span>RESPONSE: " + e.data + "</span>");
      
      let data = JSON.parse(e.data);
      if (data.method.toUpperCase() == "RES") {
        nt = data.data;
  
        refresh();
       
      }
    };
  
    ws.onerror = function (e) {
      console.log("<span class=error>ERROR:</span> " + e.data);
    };
  
    var log = function(msg) {
      log_content.insertAdjacentHTML("beforeend", "<p>" + msg + "</p>");
    }
  
    var update = function() {
      if (!ws_connected) {
        return;
      }
  
      ws.send("{\"method\": \"ALL\", \"data\": []}\n");
    }
  
    setInterval(update, 50);
    
  </script>
</body>
</html>